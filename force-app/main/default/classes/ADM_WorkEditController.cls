public with sharing class ADM_WorkEditController {    private ADM_Work__c work;        public ADM_WorkEditController(ApexPages.StandardController controller) {        Map<String, String> currParams = System.currentPageReference().getParameters();        for(String currParam : currParams.keySet()) {            params.put(currParam, EncodingUtil.urlEncode(currParams.get(currParam), 'UTF-8'));            }                this.work = (ADM_Work__c) controller.getRecord();            }        public Pagereference gotoEditPage() {    	List<RecordType> recordTypes = new List<RecordType>();                Pagereference pr;        String recordTypeName = '';        String recordTypeId = '';                       // 1# Use case is that we are converting record types here signified by the recordtype in the URL        // 2# Use case is that we are just editing the existing record        // 3# Use case is that we are creating a record from another type of record manually like creating        //    creating a bug from a template. We manually set the recordTypeLogicalName in this instance        //    we do this because we don't know what the ID will be in each org ahead of time        if(params.containsKey('RecordType')) {        	recordTypeId = params.get('RecordType');        	if(ADM_TextUtils.isValidIdFormat(recordTypeId)) {        		recordTypes = ADM_RecordType.getAllBy('Id', new List<String>{recordTypeId});        		if(!recordTypes.isEmpty()) {        			recordTypeName = recordTypes[0].Name;        		  	        		}        	}        } else if(work.RecordTypeId != null) {            recordTypes = ADM_RecordType.getAllBy('Id', new List<String>{work.RecordTypeId});            if(!recordTypes.isEmpty()) {                recordTypeName = recordTypes[0].Name;            }        }                if(params.containsKey('RecordTypeLogicalName')) {            recordTypeName = params.get('RecordTypeLogicalName');        }                //default record type just in case we did not find anything        if(recordTypeName == '') {            recordTypeName = ADM_Work.BUG_RECORD_TYPE_NAME;        }                if(recordTypeName.equalsIgnoreCase(ADM_Work.RECORD_TYPE_NAME_USERSTORY)) {            pr = Page.ADM_WorkEditUserStory;           } else if(recordTypeName.equalsIgnoreCase(ADM_Work.BUG_RECORD_TYPE_NAME)) {            pr = Page.ADM_WorkEditBug;        } else if(recordTypeName.equalsIgnoreCase(ADM_Work.RECORD_TYPE_NAME_TODO)) {            pr = Page.ADM_WorkEditToDo;        } else if(recordTypeName.equalsIgnoreCase(ADM_Work.RECORD_TYPE_NAME_INVESTIGATION)) {            pr = Page.ADM_WorkEditInvestigation;        } else if(recordTypeName.equalsIgnoreCase(ADM_Work.TEMPLATE_RECORD_TYPE_NAME)) {            pr = Page.ADM_WorkEditTemplate;        } else {        	pr = Page.ADM_WorkEditBug;        }                pr.getParameters().putAll(params);                return pr;       }        public RecordType recordType { get; set; }        public Map<String, String> params {         get {            if(params == null) params = new Map<String, String>();            return params;        }        set;     }}