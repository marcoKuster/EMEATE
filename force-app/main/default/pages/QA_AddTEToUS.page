<apex:page controller="QA_TreeLibrary" extensions="QA_AddTEtoUSExtension" tabStyle="QA_Test_Execution__c">    <apex:includeScript value="{!$Resource.QA_JSGeneral}"/>    <apex:includeScript value="{!$Resource.QA_JSTreeUI}"/>    <apex:stylesheet value="{!$Resource.QA_TreeCSS}"/>    <apex:sectionHeader title="Add Test Executions to a User Story"></apex:sectionHeader>    <apex:pageMessages ></apex:pageMessages>    <!----------------------------------------- Select a User Story ------------------------------------------->    <apex:pageBlock title="Select the User Story" mode="detail" rendered="{!currentStep == 0}">        <apex:outputPanel rendered="{! possibleUSSize == 0 }">        Test executions can only be added to user stories which belong to this test plan. To add test executions, please add at least one user story first.<BR /><BR />        </apex:outputPanel>        <apex:outputPanel rendered="{! possibleUSSize > 0 }">        Please select from the possible User Stories below.        </apex:outputPanel>        <apex:pageBlockTable value="{!possibleUS}" var="curUS" rendered="{! possibleUSSize > 0 }" >            <apex:column headerValue="Name" onclick="window.location = 'QA_AddTEtoUS?usid={!curUS.id}&tpid={!curTPID}';" style="cursor:hand;">                {!curUS.name}            </apex:column>            <apex:column headerValue="Id" onclick="window.location = 'QA_AddTEtoUS?usid={!curUS.id}&tpid={!curTPID}';" style="cursor:hand;">                {!curUS.id}            </apex:column>        </apex:pageBlockTable>        <apex:form id="selectUS">            <apex:commandButton action="{!toReturnPage}" immediate="true" id="cancel" value="Cancel" />        </apex:form>    </apex:pageBlock>    <!----------------------------------------- Selected User Story ------------------------------------------->    <apex:pageBlock title="Selected User Story" mode="detail" rendered="{!currentStep > 0}">        <apex:outputText value="{!userStoryInfo}" id="userStoryInfo" escape="false" />    </apex:pageBlock>    <!-------------------------------------------- Test Case Tree --------------------------------------------->    <apex:pageBlock title="Step 1: Select Test Cases" mode="detail" rendered="{!currentStep == 1}">        <script language="javascript" type="text/javascript">            var offset = 260;            var treeWidth = document.body.clientWidth - offset;        </script>        <apex:form id="apexFunctions">            <apex:actionFunction action="{!initializeBranches}" name="initTree" rerender="baseTree, openRemainingBranches">                <apex:param name="hierParam" assignTo="{!tree.baseHierarchy}" value="" />                <apex:param name="widthParam" assignTo="{!tree.uiWidth}" value="" />                <apex:param name="branchesCookieParam" assignTo="{!tree.branchesCookie}" value="" />                <apex:param name="addTCParam" assignTo="{!tree.showAddTCBtn}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!doNothing}" name="regenerateTree" rerender="baseTree">                <apex:param name="hierParam" assignTo="{!tree.baseHierarchy}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!loadBranch}" name="loadBranch" rerender="populateBranch, openRemainingBranches, openBranchesList" oncomplete="unblockLoadBranch()">                <apex:param name="pathParam" assignTo="{!tree.treePath}" value="" />                <apex:param name="targetIdParam" assignTo="{!tree.targetBranchId}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!openBranchPath}" name="openBranchPath" rerender="openRemainingBranches, openBranchesList" oncomplete="unblockLoadBranch()">                <apex:param name="pathParam" assignTo="{!tree.selectedBranch}" value="" />                <apex:param name="taskParam" assignTo="{!tree.postOpenTask}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!openAllSubBranches}" name="openAllSubBranches" rerender="openRemainingBranches, openBranchesList" oncomplete="unblockLoadBranch()">                <apex:param name="pathParam" assignTo="{!tree.selectedBranch}" value="" />                <apex:param name="taskParam" assignTo="{!tree.postOpenTask}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!doNothing}" name="openRemainingBranches" rerender="openRemainingBranches">            </apex:actionFunction>            <apex:actionFunction action="{!removeOpenBranch}" name="removeOpenBranchApex" rerender="openBranchesList" oncomplete="unblockSelectBranch()">                <apex:param name="pathParam" assignTo="{!tree.selectedBranch}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!addOpenBranch}" name="addOpenBranchApex" rerender="openBranchesList" oncomplete="unblockSelectBranch()">                <apex:param name="pathParam" assignTo="{!tree.selectedBranch}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!loadDetails}" name="loadDetails" rerender="populateDetails" oncomplete="unblockLoadDetails()">                <apex:param name="tcIdParam" assignTo="{!tree.elemId}" value="" />                <apex:param name="targetIdParam" assignTo="{!tree.targetElemId}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!selectElem}" name="selectElem" rerender="" oncomplete="unblockSelect()">                <apex:param name="idParam" assignTo="{!tree.selectedId}" value="" />                <apex:param name="pathParam" assignTo="{!tree.selectedPath}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!selectElems}" name="selectElems" rerender="" oncomplete="unblockSelect()">                <apex:param name="idParam" assignTo="{!tree.selectedId}" value="" />                <apex:param name="pathParam" assignTo="{!tree.selectedPath}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!deselectElem}" name="deselectElem" rerender="" oncomplete="unblockSelect()">                <apex:param name="idParam" assignTo="{!tree.selectedId}" value="" />                <apex:param name="pathParam" assignTo="{!tree.selectedPath}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!deselectElems}" name="deselectElems" rerender="" oncomplete="unblockSelect()">                <apex:param name="idParam" assignTo="{!tree.selectedId}" value="" />                <apex:param name="pathParam" assignTo="{!tree.selectedPath}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!addChangedOrder}" name="addChangedOrderApex" rerender="" oncomplete="unblockChangedOrder()">                <apex:param name="idParam" assignTo="{!tree.changedOrderId}" value="" />                <apex:param name="valueParam" assignTo="{!tree.changedOrderValue}" value="" />                <apex:param name="pathParam" assignTo="{!tree.changedOrderPath}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!removeChangedOrder}" name="removeChangedOrderApex" rerender="" oncomplete="unblockChangedOrder()">                <apex:param name="idParam" assignTo="{!tree.changedOrderId}" value="" />                <apex:param name="pathParam" assignTo="{!tree.changedOrderPath}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!loadACMatches}" name="loadACMatches" rerender="populateAC">                <apex:param name="acHierParam" assignTo="{!tree.acHier}" value="" />            </apex:actionFunction>            <apex:actionFunction action="{!searchTree}" name="searchTreeApex" rerender="populateSearch">                <apex:param name="searchParam" assignTo="{!tree.searchTerm}" value="" />                <apex:param name="hierParam" assignTo="{!tree.searchPath}" value="" />            </apex:actionFunction>        </apex:form>        <div id="treeWrapper" style="position:relative">            <table border="0" cellspacing="0" cellpadding="0" id="controlTable">                <tr>                    <td><apex:outputText value="{!confirmationMessage}" id="confirmationMessage" escape="false" /></td>                </tr>                <tr>                    <td bgcolor="#F6F6F6" class="textRegular borderLeftDark borderRightDark borderTopDark" style="padding:3px;">                        <div id="AC.div" style="position:relative">                            <script language="javascript" type="text/javascript">                                document.write("<input id=\"AC.tf\" autocomplete=\"off\" onfocus=\"acTFFocus()\" onblur=\"acTFBlur()\" onkeyup=\"acKeyUp(event)\" onkeydown=\"acKeyDown(event)\" type=\"text\" class=\"textRegular\" style=\"width:" + (treeWidth - 67) + "px; background-color:#FBFBFB; border:solid; border-width:1px; border-color:#666666\" />");                            </script>                            <input id="AC.btn" onclick="regenerateTreeWrapper()" type="button" class="textRegular" value="Go" style="width:50px; background-color:#FBFBFB; border:solid; border-width:1px; border-color:#666666" />                            <div id="ACList" style="position:absolute; top:20px; z-index: 20;" onmouseover="acListOver()" onmouseout="acListOut()"></div>                        </div>                    </td>                </tr>                <tr>                    <td bgcolor="#F6F6F6" class="textRegular borderLeftDark borderRightDark borderTopDark borderBottomDark">                        <apex:tabPanel id="controlPanel" selectedTab="filters" switchType="client">                            <apex:tab label="Filter By" name="filters" id="filtersTab">                                <apex:form id="treeFilters">                                    <apex:panelGrid columns="4">                                        <apex:outputPanel >Execution Type</apex:outputPanel>                                        <apex:outputPanel >Priority</apex:outputPanel>                                        <apex:outputPanel >Related To</apex:outputPanel>                                        <apex:outputPanel />                                        <apex:selectList id="ExecutionType" size="1" title="Execution Type" value="{!tree.executionTypeFilter}">                                            <apex:selectOptions value="{!executionTypeFT}" />                                        </apex:selectList>                                        <apex:selectList id="Priority" size="1" title="Priority" value="{!tree.priorityFilter}">                                            <apex:selectOptions value="{!priorityFT}" />                                        </apex:selectList>                                        <apex:selectList id="RelatedTo" size="1" title="Related To" value="{!tree.relatedToFilter}">                                            <apex:selectOptions value="{!relatedToFT}" />                                        </apex:selectList>                                        <apex:commandButton action="{!filter}" value="Filter" id="filter" rerender="baseTree, openRemainingBranches"/>                                    </apex:panelGrid>                                </apex:form>                            </apex:tab>                            <apex:tab label="Search" name="search" id="searchTab" >                                <table width="100%" class="textRegular" border="0" cellspacing="0" cellpadding="0">                                    <tr>                                        <td>                                            <input name="search.tf" onkeydown="searchEnter(event)" type="text" class="textRegular" id="search.tf" style="width:250px; border:solid; border-width:1px; border-color:#666666" />                                            <input name="search.btn" onclick="searchTree()" type="submit" class="textRegular" id="search.btn" value="Search" style="width:50px; background-color:#FBFBFB; border:solid; border-width:1px; border-color:#666666" />                                        </td>                                    </tr>                                    <tr>                                        <td height="3"></td>                                    </tr>                                    <tr align="left">                                        <td style="background-color:#FBFBFB; padding:3px">                                            <div id="searchResults"></div>                                        </td>                                    </tr>                                </table>                            </apex:tab>                        </apex:tabPanel>                    </td>                </tr>                <tr>                    <td height="4"></td>                </tr>                <tr>                    <td><apex:outputText value="{!baseTree}" id="baseTree" escape="false" /></td>                </tr>                <tr>                    <td height="4"></td>                </tr>                <tr>                    <td>                        <apex:form >                            <apex:commandButton action="{!toStep2}" id="toStep2" value="Select Test Cases" />                            <apex:commandButton action="{!toReturnPage}" id="cancel" value="Cancel" />                        </apex:form>                    </td>                </tr>            </table>            <div id="loadBg" class="loadDivBg"></div>            <div id="loadText" class="loadDivText"> Please hang on, still loading... </div>        </div>        <apex:form id="openBranchesList" >            <script language="javascript">                var openBranches = "{!openBranchesString}";            </script>        </apex:form>        <apex:form id="populateBranch" >            <script language="javascript">                var curBranchHtml = ("<apex:repeat var="elem" value="{!tree.curBranch}" >{!elem}</apex:repeat>");                targetDiv = document.getElementById("{!tree.targetBranchId}.content");                if(targetDiv != null) targetDiv.innerHTML = curBranchHtml;            </script>        </apex:form>        <apex:form id="populateDetails" >            <script language="javascript">                var curDetailsHtml = ("{!tree.curDetails}");                targetDiv = document.getElementById("{!tree.targetElemId}.content");                if(targetDiv != null) targetDiv.innerHTML = curDetailsHtml;            </script>        </apex:form>        <apex:form id="populateAC" >            <script language="javascript">                var curACHtml = ("{!tree.acMatches}");                var acMatchCount = "{!tree.acMatchCount}";                var acCurSelection = 0;                targetDiv = document.getElementById("ACList");                if(targetDiv != null) targetDiv.innerHTML = curACHtml;            </script>        </apex:form>        <apex:form id="populateSearch" >            <script language="javascript">                var curSearchHtml = ("{!tree.searchMatches}");                targetDiv = document.getElementById("searchResults");                if(targetDiv != null) targetDiv.innerHTML = curSearchHtml;            </script>        </apex:form>        <apex:form id="openRemainingBranches" >            <script language="javascript">                if({!anymoreOpenBranches}){                    forceLoadBranch("{!nextOpenBranch}");                }else{                    {!tree.postOpenTask};                    hideLoadScreen();                }            </script>        </apex:form>        <script language="javascript" type="text/javascript">            document.getElementById("controlTable").width = treeWidth;            initTree("All", treeWidth, "", false);            initTreeUI("rgb(242,242,242)","rgb(221,221,221)","rgb(190,238,190)","rgb(140,238,140)");        </script>    </apex:pageBlock>    <!------------------------------------------ Selected Test Case ------------------------------------------->    <apex:pageBlock title="Selected Test Cases" mode="detail" rendered="{!currentStep > 1}">        <apex:pageBlockTable value="{!selectedTestCases}" var="case">            <apex:column headerValue="Brief Description" value="{!case.Brief_Description__c}" />            <apex:column headerValue="Hierarchy" value="{!case.Hierarchy__c}" />            <apex:column headerValue="Priority" value="{!case.Priority__c}" />            <apex:column headerValue="Execution Type" value="{!case.Execution_Type__c}" />        </apex:pageBlockTable>    </apex:pageBlock>    <!---------------------------------------- Create Test Executions ------------------------------------------>    <apex:pageBlock title="Step 2: Create Test Executions" mode="detail" rendered="{!currentStep == 2}">        <apex:form id="createTE">            <table width="100%">                <tr>                    <td width="20%"><strong>Assignee</strong></td>                    <td><apex:inputField id="assigneee" value="{!baseTE.Assignee__c}"  required="true"/></td>                </tr>                <tr>                    <td><strong>Status</strong></td>                    <td><apex:inputField id="status" value="{!baseTE.Status__c}"  required="true"/></td>                </tr>                <tr>                    <td><strong>Type</strong></td>                    <td><apex:inputField id="type" value="{!baseTE.Type__c}"  required="true"/></td>                </tr>                <tr>                    <td><strong>Date of Last Execution</strong></td>                    <td><apex:inputField id="last" value="{!baseTE.Date_of_Last_Execution__c}" required="{!dateRequired}"/></td>                </tr>                <tr>                    <td><strong>Number of Executions</strong></td>                    <td><apex:inputField id="num" value="{!baseTE.Number_of_Executions__c}" /></td>                </tr>                <tr>                    <td><strong>Build # of Last Execution</strong></td>                    <td><apex:inputField id="build" value="{!baseTE.Build_of_Last_Execution__c}" /></td>                </tr>                <tr>                    <td><strong>Bugs</strong></td>                    <td>                        <apex:inputField id="bugs" value="{!baseTE.Bugs__c}" />                        <div class="errorMsg"><apex:outputText value="{!bugValidationError}" id="bugValidationError" escape="false" /></div>                    </td>                </tr>                <tr>                    <td colspan="2">                        <apex:commandButton id="createTEs" value="Create Executions" action="{!createTEs}"/>                        <apex:commandButton action="{!toReturnPage}" immediate="true" id="cancel" value="Cancel" />                    </td>                </tr>            </table>        </apex:form>    </apex:pageBlock>    <!------------------------------------- Create Test Execution Results --------------------------------------->    <apex:pageBlock title="Test Execution Creation Results" mode="detail" rendered="{!currentStep == 3}">        <apex:form id="createdTEs">            <table width="100%">                <tr>                    <td>                        <apex:pageBlockTable value="{!createdTEResults}" var="result">                            <apex:column headerValue="Creation Result">                                <img src="{!result.isSuccess}" />                            </apex:column>                            <apex:column headerValue="Test Case">                                <a href="/{!result.te.Test_Case__c}" target="_blank">{!result.tcName}</a>                            </apex:column>                            <apex:column headerValue="Test Execution Status">                                {!result.te.Status__c}                            </apex:column>                            <apex:column headerValue="Test Execution Type">                                {!result.te.Type__c}                            </apex:column>                            <apex:column headerValue="Test Execution Id">                                <a href="/{!result.id}" target="_blank">{!result.id}</a>                            </apex:column>                        </apex:pageBlockTable>                    </td>                </tr>                <tr>                    <td>                        <apex:commandButton id="finish" value="Finish" action="{!toReturnPage}" />                    </td>                </tr>            </table>        </apex:form>    </apex:pageBlock></apex:page>